# Synchronization
---
[Go Back](../README.md)

---
## How a computer knows what time it is
- Several quartz clocks. For example the one for the CPU clock signal.
- To measure passage of time a quartz crystal (piezoelectric) is used.
	- The cristal oscillates (Current = deformed shape, deformed shape = current)
- Steps:
	1. Counter register measures crystal osculations. (slightly different between crystals)
	2. When threshold is reached, it generates a hardware interrupt.
	3. Interrupt counter is updated.
	4. Interrupt counter is compared to the boot time.
- Ways of knowing the boot time.
	- Ask user (early PCs)
	- BIOS clock (requires a battery)
	- Over the network (NTP - Network Time Protocol)
- More precise time?
	- Have a radio receiver to receive time signal generated by atomic clocks.
	- Incorporate GPS.
---
## Synchronization of physical clocks
- **Objective**: Know the exact time.
### Synchronization frequency
- Defining a perfect clock with: $C(t) = t \implies C' = 1$
	- If $C' > 1$ the clock goes forward and if $C' < 1$ it goes backward.
- So we know how far from the exact clock. Drift ratio $= C' - 1$
	- Manufacturers provide a maximum drift ratio: $C' = 1 \pm ρ$
	- So if $\Delta$ time has passed the maximum difference is: $δ = 2ρ\Delta$
### The network delay
- When asking the time over the network we define:
	- Client send the request at T1.
	- Time server receives the request at T2.
	- Time server sends the response at T3. (updated)
	- Client receives the response at T4. (outdated)
- Real time will be the received time $T$ plus $T4 - T3$.
- Christian Algorithm (1989). Use approximation $T + (T4 - T1)/2$.
### Local clock update
- Clock cannot go back. To go forward, the speed of the local clock is increased.
- Example. `make` utility use timestamps.
### Marzullo Algorithm
1. Ask several servers for a interval for the exact time.
2. Order from smallest to largest all interval edges.
3. For each interval opening or closing instant $t$
	1. Count the number of overlaps for $t$
	2. Choose the edges with highest number of overlaps.
---
## Logical clocks
- **Objective**: Know order of some events but not necessary the exact time.
- Establish event relations:
	- A before B $\to A < B$
	- A before B $\to A > B$
	- A concurrent to B $\to A || B$
### Lamport’s algorithm
1. Each machine has its own counter.
2. It can be known that if a message is send at $T_A$ and received at $T_B$ then $T_A < T_B$
3. If a machine receives a message and $T_A > T_B$ it updates its logical clock to $T_A +1$
4. Some order relations between events become demonstrable.
5. Some others still are indemonstrable.
---