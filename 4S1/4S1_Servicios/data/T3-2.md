
---
# Acceso Remoto

[Back to index](../README.md)

---
## Introducción
- **Def**. Permite gestionar un servidor via internet.
- **Tipos**
	- Terminales de texto
		- Telnet (Inseguro, sin cifrado)
		- SSH - Secure Shell (Seguro, Cifrado)
	- Terminales gráficas
		- X-Window (Usado en servidores Unix)
		- RDP - Remote Desktop Protocol (Servidores Win. Propietario MS)
		- RFP - Remote Framebuffer Protocol (Open source)
- **Telnet y SSH**
	- Similitudes.
		- Proporcionan terminal remota
		- Requieren identificación y autenticación del usuario
		- Mantienen sesión en la que interactúa con una shell
	- Diferencias
		- Método de identificación y autenticación
		- Método de transporte
		- Versatilidad
---
## Telnet
### Funcionamiento
- **Network Virtual Terminal (NVT)**
	- Abstracción de una terminal física real.
	- NVT y terminal física no tienen las mismas características.
	- Servidor/cliente debe traducir características.
- **Simetría de extremos**
	- Tanto servidor como cliente se consideran una NVT.
	- Ambas NVT tienen las mismas características.
	- Pueden ser distintas de las de las terminales reales. Son un "denominador común".
- **Negociación de opciones**
	- Al inicio de la conexión ambas NVT negocian (des)activación de características
	- Mensajes binarios de negociación
		- `WILL X`. Una parte anuncia que usará la característica `X`.
			- Respuesta: `DO X` o `DON'T X`.
		- `DO X`. Una parte solicita que la otra use la característica `X`. 
			- Respuesta: `WILL X` o `WON'T X`.
### Codificación
Usa codificación binaria (7b) para tanto datos como comandos.

| Código | HEX    | Comando                    | Significado                                                                   |
| ------ | ------ | -------------------------- | ----------------------------------------------------------------------------- |
| 255    | `0xFF` | Interpret As Command (IAC) | Siguiente byte es un comando.<br>Otro byte opcional con opciones del comando. |
| 254    | `0xFE` | DONT                       | Pide no usar característica en siguiente byte.                                |
| 253    | `0xFD` | WILL                       | Usará característica descrita en siguiente byte.                              |
| 252    | `0xFC` | WON'T                      | No usará característica en siguiente byte.                                    |
| 251    | `0xFB` | DO                         | Pide usar característica en siguiente byte.                                   |
#### Ejemplo
```
Petición de no usar echo (Ej. contraseña)
IAC DONT ECHO (1) => FF FE 01

Respuesta negativa. No usara echo
IAC WONT ECHO (1) => FF FC 01
```
---
## Secure Shell (SSH)
### Uso de Claves
- ***Host Key* o Clave de anfitrión**
	- Par de claves asimétricas (público/privada) almacenadas en disco por el servidor.
	- Usadas para autenticar al servidor ante el cliente.
	- El cliente debe conocer la pública (¿Certificados? ¿PKI?)
- ***User Key* o Clave de usuario**
	- Análoga a *Host Key* pero para el cliente.
- ***Session Key* o Clave de sesión**
	- Clave simétrica generada exclusivamente para una sesión.
	- Usada para cifrar los datos en transporte.
	- Compartida por cliente y servidor. No se almacena nunca en disco.
- ***Server Key* o Clave de servidor**
	- Usada en SSH-1 pero en desuso en SSH-2.
	- Par de claves asimétricas generadas por servidor para proteger la *Session Key*.
### Gestión de Claves
- Las asimétricas las suele generar el usuario con `ssh-keygen`
- El cliente almacena las claves públicas de hosts en `~/.ssh/known_hosts`
- El servidor almacena las claves públicas de usuarios en `<usuario>/.ssh/authorized_keys`.
### Funcionamiento
1. `SSH-TRANS`. **Establecimiento de conexión**
	1. Cliente conecta a puerto 22 (por defecto)
	2. Cliente y servidor anuncian que versiones SSH soportan.
		1. Si no compatibles se desconectan.
		2. Si compatibles comunicación binaria longitud-contenido.
	3. Negocian que algoritmos soportan
		1. Intercambio de claves / firma / cifrado simétrico / MAC / compresión
	4. Cliente y servidor acuerdan una clave compartida (*Session Key*)
		1. Normalmente usan Diffie-Hellman que incluye firma digital con *Host Key*
		2. El servidor envía su *Host Key* para verificar la firma. El cliente debe confiar en ella.
		3. La responsabilidad de confiar en el servidor recae en el usuario.
	5. Toda conexión a partir de este punto es segura
		1. Cifrado con la *Session Key* e integridad con MAC.
2. `SSH-USERAUTH`. **Autenticación de cliente**
	1. Opción 1. *Keyboard Interactive* o Contraseña
		1. El cliente pide una contraseña al usuario, la envía al servidor y este se 
	2. Opción 2. Clave pública