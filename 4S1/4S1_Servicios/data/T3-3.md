
---
# Transferencia de archivos

[Back to index](../README.md)

---
## Introducción
- **Funcionalidades**
	- Examinar archivos de carpeta remota
	- Borrar y renombrar dichos archivos
	- Transferir archivos (*up* y *down*)
- **Interfaces**
	- Con cliente específico (consola o GUI)
		- **File Transfer Protocol (FTP)**. Antiguo. Casi en desuso
		- **Secure Copy (SCP)**. Copia archivos sobre SSH-1.
		- **Secure FTP (SFTP)**. Copia de archivos y más opciones sobre SSH-2
		- **FTP sobre SSL (FTPS)**. FTP sobre SSL/TLS
	- Integrados en sistema de archivos de cliente
		- **Network File System (NFS)**. Primer sistema de archivos remoto.
		- **Server Message Block (SMB)**. "Carpetas compartidas" en Windows (Microsoft)
		- **samba**. Implementación libre de SMB
		- **SSH File System (SSH-FS)**. NFS sobre ssh
	- Herramientas de colaboración (SVN / Git / WebDAV)
---
## File Transfer Protocolo
### Introducción
- Permite autenticación de usuario o "modo anónimo" (sin autenticación)
- No está cifrado. Es inseguro.
- Usa dos conexiones TCP (control y datos)
### Arquitectura
- **Componentes**
	- Cliente
		- Interfaz de usuario
		- Intérprete de protocolo de cliente (canal de control)
		- Proceso de Transferencia de Datos o DTP (canal de datos)
	- Servidor
		- Intérprete de protocolo de servidor (canal de control)
		- Proceso de Transferencia de Datos o DTP (canal de datos)
- **Funcionamiento**
	- El interprete de protocolo del servidor siempre se conectan con el del cliente.
	- Los DTP conectan los sistemas de archivos y se comunican con otros DTP.
	- UN DTP de servidor pueden conectarse con otro igual siempre orquestados por un cliente.
### Canales de Comunicación
- **Canal de Control** (puerto 21)
	- **Def**.
		- Transporta comandos del cliente y respuestas del servidor.
		- Permanece activo durante la sesión.
	- **Comandos**
		- Similar a telnet. Comandos en cadenas ASCII terminadas por `\r\n`
		- Algunas acciones requieren multiples comandos.
	- **Respuestas**
		- Respuestas con código + mensaje. Pueden requerir apertura de canal de datos.
		- Sintaxis de respuestas
			- Una línea: Código + espacio + descripción
			- Varias líneas: Código + `-` + Descripción + Líneas... + Código + espacio + Línea
	- **Códigos numéricos**
		- Primer dígito indica estado:
			- `1` Positivo preliminar / `2` Positivo / `3`Positivo Intermedio
			- `4` negativa transitoria / `5` negativa permanente
		- Segundo dígito indica categoría
			- `0` Genéricos / `1` Info / `2` Conexión / `3` Auth / `5` *filesystem*
		- Tercer dígito indica una función concreta en la categoría.
- **Canal de Datos** (puerto 22)
	- Se establece y cierra para cada transferencia.
	- Pueden ser ASCII (carácter especial `\n`) o binaria.
### Comandos

| Mensaje | Descripción                                               |
| ------- | --------------------------------------------------------- |
| USER    | Envía el nombre de usuario, para autenticación            |
| PASS    | Envía la contraseña del usuario, para autenticación       |
| PORT    | Envía el puerto de escucha del cliente (modo activo)      |
| PASV    | Solicita modo pasivo                                      |
| LIST    | Obtener listado del directorio actual                     |
| CWD     | Cambio de directorio actual                               |
| CDUP    | Subir un directorio                                       |
| TYPE    | Establece el modo de la conexión de datos (ascii/binaria) |
| RETR    | Solicita descarga de archivo                              |
| STOR    | Solicita subida de archivo                                |

### Modos
- **Modo Activo** (*default*)
	1. El cliente inicia la conexión de control al servidor.
	2. El cliente crea un socket de escucha para los datos y envía el número de puerto.
	3. En cada transferencia (solicitada en control) es el servidor el que inicia el canal de datos.
	4. Bloqueada por Firewalls y no funciona con NAT ya que es una conexión TCP entrante.
- **Modo Pasivo**
	1.  El cliente inicia la conexión de control al servidor y solicita el modo pasivo.
	2. El servidor crea un socket de escucha para los datos y envía el número de puerto.
	3. En cada transferencia es el cliente el que inicia el canal de datos.
	4. Puesto que es una conexión TCP saliente, funciona con NAT y Firewalls.
---