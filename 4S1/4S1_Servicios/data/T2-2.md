
---
# Web. Protocolo HTTP

[Back to index](../README.md)

---
## Proxies 
- **Definición**. Servidores intermedios entre cliente y servidor
- **Tipos**:
	- Directo
		- Se encuentra al lado del cliente. Puede ser transparente.
		- Filtra contenidos, monitoriza hosts y mejora eficiencia caché.
	- Inverso
		- Se encuentra al lado del servidor
		- Mejora la eficiencia (load-balancing, caché, SSL) y seguridad del servidor.

---
## Cachés
- **Definición**.
	- Copia de recursos en almacén cercano para reducir uso de red y tiempos.
	- Puede ser local (navegador) o remota (servidor intermedio)
- **Códigos de Respuesta HTTP**
	- `304 Not Changed`. Indica que la copia en caché es válida.
	- `200 OK`. Indica que se envía el recurso actualizado
- **Estrategias de caché y cabeceras**
	- **Fecha de modificación**
		- `Last-Modified`
			- Usado en respuesta servidor.
			- Última fecha de modificación de recurso en servidor.
		- `If-Modified-Since`
			- Usado en petición cliente si recurso solicitado está cacheado.
			- Fecha de mod. que el cliente obtuvo previamente con `Last-Modified`
	- **Cambio de contenido**
		- `ETag`
			- Usado en respuesta servidor.
			- Contiene hash del contenido del recurso.
		- `If-None-Match
			- Usado en petición cliente si recurso solicitado está cacheado.
			- Contiene el hash que el cliente obtuvo previamente con `ETag`
	- **Fecha de Caducidad**
		- `Cache-Control: max-age` (en respuesta servidor)
			- Contiene el tiempo durante el cual el cliente no volverá a solicitar el recurso.
		- `Cache-Control: no-cache` (en petición cliente)
			- Evita que el proxy intermedio responda con el recurso en caché.
		- Posibles valores
			- `Cache-Control: no-cache`. No guardar en cache.
			- `Cache-Control: public`. Puede guardarse en caché de proxies.
			- `Cache-Control: private` Puede guardarse en caché cliente.
			- `Cache-Control: max-age=3000`. Puede guardarse pero caduca en 3000s.
---
## Páginas Generadas Dinámicamente
- **Definición**
	- Recurso generado a partir de la ejecución de un programa externo.
	- Argumentos obtenidos con `GET` (parámetros URL) o `POST`.
- **Tecnologías**
	- **Common Gateway Interface (CGI)**
		- Servidor web crea procesos con `fork()` y pasa argumentos como env. variables.
		- Obsoleto. Sobrecarga de crear un proceso por petición.
	- **Módulos de servidor Web**
		- Servidor web es capaz de interpretar ciertos lenguajes
		- Código puede estar embebido en HTML (php) o no (python).
		- No permite máquinas separadas ni optimización estático/dinámico.
	- **Fast CGI / SCGI**
		- Ejecución de código en servidor externo de aplicaciones.
		- Argumentos y resultados comunicados por sockets con protocolo binario (Fast CGI)
		- Más complejo de configurar.
	- **ASP:NET**
		- Similar a los módulos de servidor embebidos pero basados en .NET.
		- Sistema cerrado propietario de Microsoft.
	- **Tecnologías Java**
		- Usan java para ejecutar código en un contenedor de servlets
		- Tipos:
			- **Java Servlets**. Clase de java genera la página web.
			- **Java Server Pages (JSP)**. Java directamente embebido en HTML.
		- Entorno cerrado (solo Java) con peor respuesta a sobrecarga

---
## Sesiones
- **Definición**
	- Es un conjunto de peticiones al mismo servidor desde el mismo usuario.
	- En HTTP cada petición es una conexión TCP independiente.
	- Uso de cabeceras para identificar al cliente.
- **Token de sesión**
	- Durante su primera interacción con un cliente, el servidor genera un ID único para él.
	- El servidor envía el token al cliente y este deberá usarlo para identificarse en cada petición.
	- Normalmente se mandar con [cookies](#Cookies) pero también se puede mandar en la URL.
- **Token en URL** (inseguro)
	1. El cliente solicita un recurso. `GET www.sitio.com/recurso`
	2. El servidor:
		1. Genera un nuevo token (`token`)
		2. Responde con `302 Found` y la URL `www.sitio.com/recurso?sid=new-token`
	3. El cliente hace un `GET` a esa URL que ahora incluye su session id (`sid`)
	4. El servidor ahora identifica al cliente por su session id (`sid`).
	5. Las futuras peticiones del cliente contendrán el id de sesión `...?sid=new-token`

---
## Cookies
- **Definición**
	- Información que el servidor envía en la cabecera con `Set-Cookie`.
	- El cliente la almacena en memoria asociada al servidor. No tiene por que entenderla.
	- El cliente la incluye en cada petición al servidor en cabecera `Cookie`.
- **Sintaxis**
	- **Respuesta servidor**. `Set-Cookie: Nombre=valor ; atributos`. 
		- Los atributos (`clave=valor`) definen aspectos de la cookie.
		- `Set-Cookie` pude incluirse varias veces en la cabecera.
	- **Petición cliente**. `Cookie: Nombre=valor ; Nombre=valor ; ...`. 
		- Puede incluir varias cookies en el mismo campo.
- **Usos**
	- Identificación de sesión
	- Personalización y preferencias
	- Seguimiento y estadísticas (Por ley en UE require aceptación de usuario)
- **Tipos de cookies**
	- **De sesión**. Son volátiles. El navegador las borra al cerrarlo.
	- **Persistentes**.  Especifican caducidad. Almacenadas para varias sesiones
- **Cookies de terceros**
	1. El cliente solicita un recurso (incluyendo cookies): `GET noticias.com`
	2. La respuesta del servidor incluye recursos externos: `<img src="externo.com">`
	3. El cliente solicita esos recursos `GET externo.com`
	4. El cliente incluye las cookies para ese recurso (cookies de terceros)
---
## Autenticación
- **Definición**
	- El servidor restringe el acceso a ciertos recursos.
	- Necesidad de identificar a los usuarios.
- **Funcionamiento**
	1. El cliente solicita un recurso protegido: `GET recurso`
	2. El servidor responde: `401 Unauthorized`
		1. Incluye la cabecera `WWW-Authenticate: Basic realm="Mensaje"`
		2. Donde `Basic` es el tipo de autenticación y `realm` el ID del área restringida.
	3. El cliente solicita el recurso de nuevo incluyendo el campo `Authorization: Basic XXX`.
		1. Donde `XXX` es la representación en Base64 del `usuario:clave` (solo para Basic)
- **Ejemplo de uso en "Capa de aplicación"**
	1. Cliente. `GET / HTTP/1.1`
	2. Servidor. `HTTP1.1 303 See Other <CRLF> Location: /login_form`
	3. Cliente. `GET / HTTP/1.1```
	4. `POST `

---