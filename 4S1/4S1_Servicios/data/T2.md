
---
# Web. Protocolo HTTP

[Back to index](../CS/OS/README.md)

---
## Arquitectura básica
### Introducción
- **Roles**
	- **Servidor**. Almacena recursos
	- **Cliente**. Solicita recursos
- **Transacciones (TCP)**
	- **Petición HTTP**. El cliente solicita un recurso.
	- **Respuesta HTTP**. El servidor responde y se cierra la conexión.
- **Estructura mensajes**
	- **Sobre**. Línea inicial y cabecera
	- **Contenido**
- **Recursos**
	- Contenido binario asociado a un tipo MIME
	- Puede estar en el disco del servidor o generarse cuando se piden (recursos dinámicos)
- **Estándar MIME**
	- Texto (`text/html`, `text/plain`, `text/css`, `text/xml`)
		- Ejecutables (`text/javaescript`)
	- Imagen (`image/gif`, `image/png`, `image/jpeg`, `image/bmp`, `image/webp`)
	- Audio (`audio/midi`, `audio/mpeg, audio/webm, audio/ogg, audio/wav`)
	- Vídeo (`video/mpeg`, `video/webm`, `video/ogg`)
	- Otros/application (`application/xml`, `application/pdf`)
### Universal Resource Identifier (URI)
- **Universal Resource Locator (URL)**
	- **Estructura:**
		- `http://`. Indica el esquema o protocolo
		- `usu:1234@`. Indica usuario y contraseña (opcional)
		- `www.sitio.com:80/`. Indica dominio/nodo y puerto (por defecto 80)
		- `ruta/recurso.php`. Indica ruta al recurso en ese nodo
		- `;parametro=valor`. Parámetros de sesión (opcional)
		- `?query=valor`. Envía valores/queries al servidor (opcional). Varias separadas por `&`.
		- `#seccion`. Especifica una sección dentro de la página (opcional)
	- Caracteres
		- Solo caracteres ASCII (universal) que sean legibles por los usuarios.
		- Se usa código de escape (`%`) para caracteres no permitidos (invisibles y no ASCII)
- **Universal Resource Name (URN)**
	- Usado para recursos "universales". No importa la localización.
	- Ejemplo: `urn:isbn:000-000-000-000-000`
---
## Sintaxis de los mensajes HTTP
```HTTP
GET /lugar/recurso HTTP/1.1
```

```HTTP
HTTP/1.0 200 OK
```
### Formato
- **Primera línea** (terminada en `\r\n`)
	- Petición. `<Método HTTP> <URL> <Versión HTTP>`
	- Respuesta. `Versión HTTP> <Código de estado> <Frase explicativa>`
- **Cabecera**
	- Cada campo terminado con  `\r\n` (También llamada `<CRLF>`)
	- La mayoría son opcionales.
	- Terminada con `\r\n`  (Además de él del campo: `<CRLF><CRLF>`)
- **Contenidos**
	- Formato libre (MIME).
	- Puede estar ausente.
### Métodos

| **Método** | **Acción**                                                                     |
| ---------- | ------------------------------------------------------------------------------ |
| `GET`      | Pide un recurso                                                                |
| `PUT`      | Envía datos al servidor para que los almacene en un recurso.                   |
| `DELETE`   | Borra un recurso                                                               |
| `POST`     | Pide al servidor que envíe unos datos a una aplicación de entrada (*gateway*). |
| `HEAD`     | Pide las cabeceras de un recurso.                                              |
| `OPTIONS`  | Pide las opciones existentes para un recurso.                                  |
### Códigos de Estado
- **Información: `100-199`**
	- `100` = Continue (siga enviando datos)
- **Éxito: `200-299`**
	- `200` = OK (Petición completada con éxito)
	- `204` = No content (recurso vacío)
- **Redirección: `300-399`**
	- `301` = Moved permanently (Recurso no existe pero se proporciona nuevo URL)
	- `302` = Found (HTTP/1.0 para indicar que se haga un get a nueva URL)
	- `303` = See other (Igual que `302`para HTTP/1.1)
	- `304` = Not Changed (Previamente solicitado con `200` sin ningún cambio)
	- `307` = Temporary redirect (Recurso temporalmente en otro URL proporcionado)
- **Error del cliente: `400-499`**
	- `401` = Bad Request (Petición con error de sintaxis)
	- `402` = Unauthorised (Recurso protegido. No se enviaron credenciales)
	- `403` = Forbidden (Recurso protegido. Credenciales no dan acceso)
	- `404` = Not Found (Recurso solicitado desconocido)
- **Error del servidor: `500-599`**
	- `500` = Internal Server Error (Error en el servidor. Sin detalles)
	- `501` = Not Implemented (Método solicitado no está implementado)

---
## Cabeceras HTTP
```http
HTTP/1.0 200 OK <CRLF>
Campo-1: valor 1<CRLF>
Campo-2: valor 2<CRLF><CRLF>
```
- **Generales**
	- `Date`. Fecha y hora a la que se genera el mensaje.
	- `Connection`. Tipo de conexión TCP (`keepalive`, `close`)
	- `Cache-control`. Política de cache
- **De Petición**
	- `Host`. Host al que se envía la petición (obligatorio).
	- `User-agent`. Identifica aplicación que hace la petición (navegador, OS).
	- `Accept`. Tipos de MIME aceptados.
	- `Accept-Encoding`. Métodos de compresión admitidos (`gzip`, `identity`)
	- `If-None-Match`. Evita descargar recursos que el cliente ya tiene. 
	- `Cookie`. Contiene las cookies para ese servidor. 
	- `Authorization`. Envía credenciales para recursos 
- **De Respuesta**
	- `Server`. Identifica al servidor y su versión (`apache`)
	- `WWW_Authenticate`. Tipo de autenticación.
	- `Set-Cookie`. Envía cookie al cliente.
	- `Transfer-Encoding`. Forma de envío del cuerpo (de una vez o en trozos, `chunked`)
- **De Entidad**
	- `Content-Type`. Tipo de MIME.
	- `Content-Length`. Longitud en bytes del cuerpo.
	- `Content-Language`. Idioma del texto.
	- `Etag`. Identificación del recurso usado para optimización de caché
- **De Extensión**

---
## Proxies 
- **Definición**. Servidores intermedios entre cliente y servidor
- **Tipos**:
	- Directo
		- Se encuentra al lado del cliente. Puede ser transparente.
		- Filtra contenidos, monitoriza hosts y mejora eficiencia caché.
	- Inverso
		- Se encuentra al lado del servidor
		- Mejora la eficiencia (load-balancing, caché, SSL) y seguridad del servidor.

---
## Cachés
- **Definición**.
	- Copia de recursos en almacén cercano para reducir uso de red y tiempos.
	- Puede ser local (navegador) o remota (servidor intermedio)
- **Códigos de Respuesta HTTP**
	- `304 Not Changed`. Indica que la copia en caché es válida.
	- `200 OK`. Indica que se envía el recurso actualizado
- **Estrategias de caché y cabeceras**
	- **Fecha de modificación**
		- `Last-Modified`
			- Usado en respuesta servidor.
			- Última fecha de modificación de recurso en servidor.
		- `If-Modified-Since`
			- Usado en petición cliente si recurso solicitado está cacheado.
			- Fecha de mod. que el cliente obtuvo previamente con `Last-Modified`
	- **Cambio de contenido**
		- `ETag`
			- Usado en respuesta servidor.
			- Contiene hash del contenido del recurso.
		- `If-None-Match
			- Usado en petición cliente si recurso solicitado está cacheado.
			- Contiene el hash que el cliente obtuvo previamente con `ETag`
	- **Fecha de Caducidad**
		- `Cache-Control: max-age` (en respuesta servidor)
			- Contiene el tiempo durante el cual el cliente no volverá a solicitar el recurso.
		- `Cache-Control: no-cache` (en petición cliente)
			- Evita que el proxy intermedio responda con el recurso en caché.
		- Posibles valores
			- `Cache-Control: no-cache`. No guardar en cache.
			- `Cache-Control: public`. Puede guardarse en caché de proxies.
			- `Cache-Control: private` Puede guardarse en caché cliente.
			- `Cache-Control: max-age=3000`. Puede guardarse pero caduca en 3000s.

---
## Páginas Generadas Dinámicamente


---
## Sesiones y Cookies


---
## Autenticación


---